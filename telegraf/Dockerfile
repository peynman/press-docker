ARG TELEGRAF_VERSION=1.14-alpine
FROM telegraf:${TELEGRAF_VERSION}

COPY telegraf.conf /telegraf.conf

ARG TELEGRAF_INFLUXDB_SCHEMA=http
ARG TELEGRAF_INFLUXDB_HOST=influxdb
ARG TELEGRAF_INFLUXDB_PORT=9999
ARG TELEGRAF_INFLUXDB_TOKEN=
ARG TELEGRAF_INFLUXDB_ORG=app
ARG TELEGRAF_INFLUXDB_BUCKET=app
ARG TELEGRAF_PHP_FPM_PORT=9000

RUN sed -i "s~#TELEGRAF_INFLUXDB_SCHEMA_PLACEHOLDER~$TELEGRAF_INFLUXDB_SCHEMA~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_HOST_PLACEHOLDER~$TELEGRAF_INFLUXDB_HOST~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_PORT_PLACEHOLDER~$TELEGRAF_INFLUXDB_PORT~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_TOKEN_PLACEHOLDER~$TELEGRAF_INFLUXDB_TOKEN~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_ORG_PLACEHOLDER~$TELEGRAF_INFLUXDB_ORG~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_BUCKET_PLACEHOLDER~$TELEGRAF_INFLUXDB_BUCKET~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_PHP_FPM_PORT_PLACEHOLDER~$TELEGRAF_PHP_FPM_PORT~g" /telegraf.conf


CMD [ "telegraf", "--config", "/telegraf.conf" ]
