ARG TELEGRAF_VERSION=1.14-alpine
FROM telegraf:${TELEGRAF_VERSION}

COPY telegraf.conf /telegraf.conf

ARG TELEGRAF_INFLUXDB_SCHEMA=http
ARG TELEGRAF_INFLUXDB_HOST=influxdb
ARG TELEGRAF_INFLUXDB_PORT=9999
ARG TELEGRAF_INFLUXDB_TOKEN=
ARG TELEGRAF_INFLUXDB_ORG=app
ARG TELEGRAF_INFLUXDB_BUCKET=app
ARG TELEGRAF_PHP_FPM_PORT=9000
ARG TELEGRAF_REDIS_PORT=redis
ARG TELEGRAF_REDIS_HOST=6379
ARG TELEGRAF_REDIS_PASSWORD=
ARG TELEGRAF_MARIADB_HOST=mariadb
ARG TELEGRAF_MARIADB_PASS=
ARG TELEGRAF_MARIADB_USER=root
ARG TELEGRAF_MARIADB_PORT=

RUN sed -i "s~#TELEGRAF_INFLUXDB_SCHEMA_PLACEHOLDER~$TELEGRAF_INFLUXDB_SCHEMA~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_HOST_PLACEHOLDER~$TELEGRAF_INFLUXDB_HOST~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_PORT_PLACEHOLDER~$TELEGRAF_INFLUXDB_PORT~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_TOKEN_PLACEHOLDER~$TELEGRAF_INFLUXDB_TOKEN~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_ORG_PLACEHOLDER~$TELEGRAF_INFLUXDB_ORG~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_INFLUXDB_BUCKET_PLACEHOLDER~$TELEGRAF_INFLUXDB_BUCKET~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_PHP_FPM_PORT_PLACEHOLDER~$TELEGRAF_PHP_FPM_PORT~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_REDIS_PORT_PLACEHOLDER~$TELEGRAF_REDIS_PORT~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_REDIS_HOST_PLACEHOLDER~$TELEGRAF_REDIS_HOST~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_REDIS_PASSWORD_PLACEHOLDER~$TELEGRAF_REDIS_PASSWORD~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_MARIADB_HOST_PLACEHOLDER~$TELEGRAF_MARIADB_HOST~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_MARIADB_PASS_PLACEHOLDER~$TELEGRAF_MARIADB_PASS~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_MARIADB_USER_PLACEHOLDER~$TELEGRAF_MARIADB_USER~g" /telegraf.conf
RUN sed -i "s~#TELEGRAF_MARIADB_PORT_PLACEHOLDER~$TELEGRAF_MARIADB_PORT~g" /telegraf.conf



CMD [ "telegraf", "--config", "/telegraf.conf" ]
